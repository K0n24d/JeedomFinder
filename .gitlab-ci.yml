# This file is generated by GitLab CI
Build Win32:
  script:
  - git submodule update --init
  - ''
  - set PATH=C:\Qt\Static\5.3.1\bin;C:\Qt\Tools\mingw482_32\bin;C:\Tools\bin;"C:\Program
    Files\7-Zip";%PATH%
  - qmake CONFIG+=static CONFIG+=zeroconf
  - mingw32-make release
  - pushd release
  - upx.exe --brute JeedomFinder.exe
  - signtool.exe sign /t http://time.certum.pl /a JeedomFinder.exe
  - 7z a -mx=9 JeedomFinder-Win32.zip JeedomFinder.exe
  - popd
  - git describe --exact-match --tags HEAD > VER.TMPFILE || GOTO :NOTAG
  - rem IF %errorlevel% NEQ 0 GOTO :NOTAG
  - SET /p VER= < VER.TMPFILE
  - pushd release
  - c:\Tools\bin\curl -i -F file=@JeedomFinder-Win32.zip %DEPLOY_URL%/%VER%?link=JeedomFinder/JeedomFinder-Win32.zip
  - popd
  - GOTO :CLEANUP
  - ":NOTAG"
  - git rev-parse --short HEAD > REV.TMPFILE
  - SET /p REV= < REV.TMPFILE
  - DEL REV.TMPFILE
  - pushd release
  - c:\Tools\bin\curl -i -F file=@JeedomFinder-Win32.zip %DEPLOY_URL%/snapshots/%REV%?link=JeedomFinder/snapshots/JeedomFinder-Win32.zip
  - popd
  - ":CLEANUP"
  - DEL VER.TMPFILE
  tags:
  - qt5-static
  - win32
Build Ubuntu 12.04:
  script:
  - git submodule update --init
  - qmake  CONFIG+=zeroconf
  - make
  - tar -czf JeedomFinder-Ubuntu-12.04-amd64.tar.gz JeedomFinder
  - REV=`git rev-parse --short HEAD`
  - if git describe --exact-match --tags HEAD; then
  - VER=`git describe --exact-match --tags HEAD`
  - curl -i -F file=@JeedomFinder-Ubuntu-12.04-amd64.tar.gz ${DEPLOY_URL}/${VER}?link=JeedomFinder/JeedomFinder-Ubuntu-12.04-amd64.tar.gz
  - else
  - curl -i -F file=@JeedomFinder-Ubuntu-12.04-amd64.tar.gz ${DEPLOY_URL}/snapshots/${REV}?link=JeedomFinder/snapshots/JeedomFinder-Ubuntu-12.04-amd64.tar.gz
  - fi
  image: k0n24d/ubuntu:12.04-qt4
  tags:
  - docker
Build OS-X:
  script:
  - git submodule update --init
  - export PATH=~/Qt/5.3/clang_64/bin:$PATH
  - qmake  CONFIG+=zeroconf
  - make
  - REV=`git rev-parse --short HEAD`
  - if git describe --exact-match --tags HEAD; then
  - VER=`git describe --exact-match --tags HEAD`
  - curl -i -F file=@JeedomFinder.dmg ${DEPLOY_URL}/${VER}?link=JeedomFinder/JeedomFinder.dmg
  - else
  - curl -i -F file=@JeedomFinder.dmg ${DEPLOY_URL}/snapshots/${REV}?link=JeedomFinder/snapshots/JeedomFinder.dmg
  - fi
  tags:
  - qt5
  - osx
